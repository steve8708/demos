import{r as S}from"./index-DWytQeHI.js";function L(e,t,r){if(t.length===0)return!0;r=r||Object.keys(e);const n=t.toLowerCase();return r.some(i=>{const s=e[i];return s&&typeof s=="object"?!1:String(s).toLowerCase().indexOf(n)>-1})}function D(e,t=""){var r;if(!e)return null;const n=(r=e.filteringFunction)!==null&&r!==void 0?r:L;return i=>n(i,t,e.fields)}function N(e){return typeof e=="string"?e.includes("T")?new Date(e):new Date(e+"T00:00:00"):new Date(NaN)}function O(e,t){return e instanceof Date&&typeof t=="string"?P(e).getTime()-P(N(t)).getTime():NaN}function A(e,t){return e instanceof Date&&typeof t=="string"?e.getTime()-N(t).getTime():NaN}function P(e){const t=new Date(e.getTime());return t.setHours(0,0,0,0),t}const F=new Set;function _(e){{const t=`[AwsUi] collection-hooks ${e}`;F.has(t)||(F.add(t),console.warn(t))}}const R=(e,{tokenValue:t,operator:{operator:r,match:n,tokenType:i}})=>{if(n==="date"||n==="datetime")return U({tokenValue:t,itemValue:e,operator:r,match:n});if(typeof n=="function")return n(e,t);if(n)throw new Error("Unsupported `operator.match` type given.");return K({tokenValue:t,itemValue:e,operator:r,tokenType:i})};function U({tokenValue:e,itemValue:t,operator:r,match:n}){const s=(n==="date"?O:A)(t,e);switch(r){case"<":return s<0;case"<=":return s<=0;case">":return s>0;case">=":return s>=0;case"=":return s===0;case"!=":return s!==0;default:return _(`Unsupported operator "${r}" given for match="${n}".`),!1}}function K({tokenValue:e,itemValue:t,operator:r,tokenType:n}){if(n==="enum"){if(!e||!Array.isArray(e))return _('The token value must be an array when tokenType=="enum".'),!1;switch(r){case"=":return e&&e.includes(t);case"!=":return!e||!e.includes(t);default:return _(`Unsupported operator "${r}" given for tokenType=="enum".`),!1}}switch(r){case"<":return t<e;case"<=":return t<=e;case">":return t>e;case">=":return t>=e;case"=":return t==e;case"!=":return t!=e;case":":return(t+"").toLowerCase().indexOf((e+"").toLowerCase())>-1;case"!:":return(t+"").toLowerCase().indexOf((e+"").toLowerCase())===-1;case"^":return(t+"").toLowerCase().startsWith((e+"").toLowerCase());case"!^":return!(t+"").toLowerCase().startsWith((e+"").toLowerCase());default:throw new Error("Unsupported operator given.")}}function $(e,t,r,n){const i=r.startsWith("!");return Object.keys(n)[i?"every":"some"](s=>{const{operators:o}=n[s],l=o[r];return l?R(t[s],{tokenValue:e,operator:l}):i})}function M(e,t,r){if(e.propertyKey){if(!(e.propertyKey in r)||!(e.operator in r[e.propertyKey].operators))return!1;const i=r[e.propertyKey].operators[e.operator],s=i!=null&&i.match?t[e.propertyKey]:z(t[e.propertyKey]);return R(s,{tokenValue:e.value,operator:i??{operator:e.operator}})}return $(e.value,t,e.operator,r)}function Q(e){return(t,r)=>{var n;function i(s){if("operation"in s){let o=s.operation==="and"?!0:!s.tokens.length;for(const l of s.tokens)o=s.operation==="and"?o&&i(l):o||i(l);return o}else return M(s,t,e)}return i({operation:r.operation,tokens:(n=r.tokenGroups)!==null&&n!==void 0?n:r.tokens})}}function W(e,t={tokens:[],operation:"and"}){if(!e)return null;const r=e.filteringProperties.reduce((i,{key:s,operators:o,defaultOperator:l})=>{const u={[l??"="]:{operator:l??"="}};return o==null||o.forEach(d=>{typeof d=="string"?u[d]={operator:d}:u[d.operator]={operator:d.operator,match:d.match,tokenType:d.tokenType}}),i[s]={operators:u},i},{}),n=e.filteringFunction||Q(r);return i=>n(i,t)}const z=e=>typeof e=="boolean"?e+"":e||e===0?e:"";function B(e){return e?(t,r)=>{var n,i;const s=(n=t[e])!==null&&n!==void 0?n:"",o=(i=r[e])!==null&&i!==void 0?i:"";return typeof s=="string"&&typeof o=="string"?s.localeCompare(o):s<o?-1:s==o?0:1}:null}function q(e,t){var r;if(!e||!t)return null;const n=t.isDescending?-1:1,i=(r=t.sortingColumn.sortingComparator)!==null&&r!==void 0?r:B(t.sortingColumn.sortingField);return i?(s,o)=>i(s,o)*n:null}const H=10;function Z(e,t,r){var n;if(!e)return null;const i=(n=e.pageSize)!==null&&n!==void 0?n:H,s=Math.ceil(r.length/i);let o=t??1;return(o<1||o>s&&!e.allowPageOutOfRange||Number.isNaN(o))&&(o=1),{pageSize:i,pagesCount:s,pageIndex:o}}class J{constructor(t,r){var n;if(this.size=0,this.hasNesting=!1,this.roots=new Array,this.idToChildren=new Map,this.filter=s=>(this.hasNesting?this.filterTree(s):(this.items=this.items.filter(s),this.size=this.items.length),this),this.sort=s=>(this.hasNesting?this.sortTree(s):this.items=this.items.slice().sort(s),this),this.getChildren=s=>{var o;return(o=this.treeProps&&this.idToChildren.get(this.treeProps.getId(s)))!==null&&o!==void 0?o:[]},this.getItems=()=>this.hasNesting?this.roots:this.items,this.getSize=()=>this.size,this.filterTree=s=>{const o=u=>{const d=this.getChildren(u),a=d.filter(o);return this.size-=d.length-a.length,this.setChildren(u,a),s(u)||a.length>0},l=this.roots;this.roots=this.roots.filter(o),this.size-=l.length-this.roots.length},this.sortTree=s=>{const o=l=>{l.sort(s);for(const u of l)o(this.getChildren(u))};o(this.roots)},this.size=t.length,this.items=t,this.treeProps=r,!r)return;for(const s of t){const o=r.getParentId(s);if(o===null)this.roots.push(s);else{const l=(n=this.idToChildren.get(o))!==null&&n!==void 0?n:[];l.push(s),this.idToChildren.set(o,l),this.hasNesting=!0}}const i=(s,o=1)=>{var l;for(const u of(l=this.idToChildren.get(r.getId(s)))!==null&&l!==void 0?l:[])i(u,o+1)};this.roots.forEach(s=>i(s))}setChildren(t,r){this.treeProps&&this.idToChildren.set(this.treeProps.getId(t),r)}}function X(...e){return e.some(Boolean)?t=>{for(const r of e)if(r&&!r(t))return!1;return!0}:null}function Y(e,{filteringText:t,sortingState:r,currentPageIndex:n,propertyFilteringQuery:i},{filtering:s,sorting:o,pagination:l,propertyFiltering:u,expandableRows:d}){const a=new J(e,d),p=X(W(u,i),D(s,t));p&&a.filter(p);const v=q(o,r);v&&a.sort(v);const c=a.getItems(),h=p?a.getSize():void 0,f=Z(l,n,c);return f?{items:c.slice((f.pageIndex-1)*f.pageSize,f.pageIndex*f.pageSize),allPageItems:c,filteredItemsCount:h,pagesCount:f==null?void 0:f.pagesCount,actualPageIndex:f==null?void 0:f.pageIndex,itemsTree:a}:{items:c,allPageItems:c,filteredItemsCount:h,pagesCount:void 0,actualPageIndex:void 0,itemsTree:a}}const x=(e,t)=>e?typeof e=="function"?e(t):t[e]:t,G=(e,t,r)=>{const n=new Set;return t.forEach(i=>n.add(x(r,i))),e.filter(i=>n.has(x(r,i)))},E=(e,t,r)=>{if(e.length!==t.length)return!1;const n=new Set;return e.forEach(i=>n.add(x(r,i))),t.every(i=>n.has(x(r,i)))};function k(e,t){const r=Object.assign({},e);switch(t.type){case"selection":r.selectedItems=t.selectedItems;break;case"expansion":r.expandedItems=t.expandedItems;break;case"filtering":r.currentPageIndex=1,r.filteringText=t.filteringText;break;case"sorting":r.currentPageIndex=1,r.sortingState=t.sortingState;break;case"pagination":r.currentPageIndex=t.pageIndex;break;case"property-filtering":r.currentPageIndex=1,r.propertyFilteringQuery=t.query;break}return r}function V({dispatch:e,collectionRef:t}){return{setFiltering(r){var n;e({type:"filtering",filteringText:r}),(n=t.current)===null||n===void 0||n.scrollToTop()},setSorting(r){var n;e({type:"sorting",sortingState:r}),(n=t.current)===null||n===void 0||n.scrollToTop()},setCurrentPage(r){var n;e({type:"pagination",pageIndex:r}),(n=t.current)===null||n===void 0||n.scrollToTop()},setSelectedItems(r){e({type:"selection",selectedItems:r})},setPropertyFiltering(r){var n;e({type:"property-filtering",query:r}),(n=t.current)===null||n===void 0||n.scrollToTop()},setExpandedItems(r){e({type:"expansion",expandedItems:r})}}}function ee(e,{filteringText:t,sortingState:r,selectedItems:n,expandedItems:i,currentPageIndex:s,propertyFilteringQuery:o},l,u,{pagesCount:d,actualPageIndex:a,allItems:p,allPageItems:v,itemsTree:c}){var h,f,I,m,T;let b=e.filtering?p.length?e.filtering.noMatch:e.filtering.empty:null;b=e.propertyFiltering?p.length?e.propertyFiltering.noMatch:e.propertyFiltering.empty:b;const j=e.propertyFiltering?e.propertyFiltering.filteringProperties.reduce((g,C)=>(Object.keys(p.reduce((y,w)=>(y[""+z(w[C.key])]=!0,y),{})).forEach(y=>{y!==""&&g.push({propertyKey:C.key,value:y})}),g),[]):[];return{collectionProps:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({empty:b},e.sorting?{onSortingChange:({detail:g})=>{l.setSorting(g)},sortingColumn:r==null?void 0:r.sortingColumn,sortingDescending:r==null?void 0:r.isDescending}:{}),e.expandableRows?{expandableRows:{getItemChildren(g){return c.getChildren(g)},isItemExpandable(g){return c.getChildren(g).length>0},expandedItems:i,onExpandableItemToggle:({detail:{item:g,expanded:C}})=>{const y=e.expandableRows.getId;if(C){for(const w of i)if(y(w)===y(g))return;l.setExpandedItems([...i,g])}else l.setExpandedItems(i.filter(w=>y(w)!==y(g)))}},trackBy:e.expandableRows.getId}:{}),e.selection?{onSelectionChange:({detail:{selectedItems:g}})=>{l.setSelectedItems(g)},selectedItems:n,trackBy:(h=e.selection.trackBy)!==null&&h!==void 0?h:(f=e.expandableRows)===null||f===void 0?void 0:f.getId}:{}),{ref:u,firstIndex:1,totalItemsCount:v.length}),!((I=e.pagination)===null||I===void 0)&&I.pageSize?{firstIndex:((a??s)-1)*e.pagination.pageSize+1}:{}),filterProps:{filteringText:t,onChange:({detail:{filteringText:g}})=>{l.setFiltering(g)}},propertyFilterProps:{query:o,onChange:({detail:g})=>{l.setPropertyFiltering(g)},filteringProperties:((m=e.propertyFiltering)===null||m===void 0?void 0:m.filteringProperties)||[],filteringOptions:j,freeTextFiltering:(T=e.propertyFiltering)===null||T===void 0?void 0:T.freeTextFiltering},paginationProps:{currentPageIndex:a??s,pagesCount:d,onChange:({detail:{currentPageIndex:g}})=>{l.setCurrentPage(g)}}}}function te(e,t){var r,n,i,s,o,l,u,d,a,p,v;const[c,h]=S.useReducer(k,{selectedItems:(n=(r=e.selection)===null||r===void 0?void 0:r.defaultSelectedItems)!==null&&n!==void 0?n:[],expandedItems:(s=(i=e.expandableRows)===null||i===void 0?void 0:i.defaultExpandedItems)!==null&&s!==void 0?s:[],sortingState:(o=e.sorting)===null||o===void 0?void 0:o.defaultState,currentPageIndex:(u=(l=e.pagination)===null||l===void 0?void 0:l.defaultPage)!==null&&u!==void 0?u:1,filteringText:(a=(d=e.filtering)===null||d===void 0?void 0:d.defaultFilteringText)!==null&&a!==void 0?a:"",propertyFilteringQuery:(v=(p=e.propertyFiltering)===null||p===void 0?void 0:p.defaultQuery)!==null&&v!==void 0?v:{tokens:[],operation:"and"}}),f=S.useMemo(()=>V({dispatch:h,collectionRef:t}),[h,t]);return[c,f]}function ne(e,t){const r=S.useRef(null),[n,i]=te(t,r),{items:s,allPageItems:o,pagesCount:l,filteredItemsCount:u,actualPageIndex:d,itemsTree:a}=Y(e,n,t),p=new Set;if(t.expandableRows)for(const c of n.expandedItems)p.add(t.expandableRows.getId(c));let v=s;if(t.expandableRows){const c=new Array,h=t.expandableRows.getId,f=I=>{for(const m of I)c.push(m),p.has(h(m))&&f(a.getChildren(m))};f(s),v=c}if(t.selection&&!t.selection.keepSelection){const c=G(v,n.selectedItems,t.selection.trackBy);E(c,n.selectedItems,t.selection.trackBy)||i.setSelectedItems(c)}if(t.expandableRows){const c=v.filter(h=>p.has(t.expandableRows.getId(h)));E(c,n.expandedItems,t.expandableRows.getId)||i.setExpandedItems(c)}return Object.assign({items:s,allPageItems:o,filteredItemsCount:u,actions:i},ee(t,n,i,r,{actualPageIndex:d,pagesCount:l,allItems:e,allPageItems:o,itemsTree:a}))}export{ne as u};

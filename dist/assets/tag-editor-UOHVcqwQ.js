import{R as g,r as c,P as D,_ as te,u as re,M as ie,O as le,b4 as O,aD as ae,b as se,K as ue,n as de,p as ce,c as ve}from"./index-DLMN1afU.js";import{I as ge}from"./internal-C9xtVrSa.js";import{F as me}from"./internal-BWpMHlT2.js";import{I as fe}from"./internal-Co3skvOO.js";import{m as ye,P as ke}from"./promises-BGwITM36.js";const q={root:"awsui_root_brdst_1ixnu_145",loading:"awsui_loading_brdst_1ixnu_149","undo-button":"awsui_undo-button_brdst_1ixnu_153"},Q=g.forwardRef(({row:t,value:s,readOnly:a,defaultOptions:o,placeholder:x,errorText:p,loadingText:d,suggestionText:f,tooManySuggestionText:i,limit:e,filteringKey:B,enteredTextLabel:y,clearAriaLabel:_,onChange:N,onBlur:I,onRequest:K,initialOptionsRef:b},V)=>{const[l,k]=c.useState(o),[P,E]=c.useState(),S=c.useRef({cancel:()=>{},isCancelled:()=>!1}),L=c.useRef({key:void 0,value:void 0}),U=(m,F)=>L.current.key===m&&L.current.value===F,h=m=>{if(!K||U(B,m)||S.current.isCancelled())return;S.current.cancel(),L.current.key!==B?k([]):m===""&&(b!=null&&b.current)&&b.current.length>0&&k(b.current),E("loading"),L.current={key:B,value:m};const{promise:F,cancel:T,isCancelled:R}=ye(K(m));F.then(M=>{const j=M.map(H=>({value:H}));E(void 0),k(j),b&&(b.current=j)}).catch(M=>{M instanceof ke||E("error")}),S.current={cancel:T,isCancelled:R}};return g.createElement(fe,{ref:V,value:s,readOnly:a,statusType:P,options:l.length<e?l:[],empty:l.length<e?f:i,placeholder:x,errorText:p,loadingText:d,enteredTextLabel:y,clearAriaLabel:_,onChange:({detail:m})=>N(m.value,t),onBlur:()=>I==null?void 0:I(t),onFocus:()=>{h("")},onLoadItems:({detail:m})=>{h(m.filteringText)}})}),Ee=g.forwardRef(({children:t,onClick:s},a)=>g.createElement("a",{ref:a,role:"button",tabIndex:0,className:q["undo-button"],onClick:s,onKeyDown:o=>{(o.keyCode===D.space||o.keyCode===D.enter)&&o.preventDefault(),o.keyCode===D.enter&&s()},onKeyUp:o=>{o.keyCode===D.space&&s()}},t));function pe(t,s){for(let a=0;a<t.length;a++)if(s(t[a]))return a;return-1}function W(t,s,a){for(let o=0;o<Math.max(t.length,s.length);o++){if(o===s.length)return t.slice(0,o);if(o===t.length)return[...t.slice(0,o),...s.slice(o)];if(!a(t[o],s[o]))return[...t.slice(0,o),s[o],...W(t.slice(o+1),s.slice(o+1),a)]}return t}function be(t,s){const a=c.useRef(t),o=W(a.current,t,s);return c.useEffect(()=>{a.current=o},[o]),o}const ee=/^([\p{L}\p{Z}\p{N}_.:/=+\-@]*)$/u,xe="aws:",_e=128,Le=256;function Z(t,s,a,o,x=ee){const p={};return t.forEach(d=>{var f;d.key&&!d.markedForRemoval&&(p[d.key]=((f=p[d.key])!==null&&f!==void 0?f:0)+1)}),t.map((d,f)=>{let i,e;if(s[f]&&Re(d.key)?i=a("i18nStrings.emptyKeyError",o==null?void 0:o.emptyKeyError):he(d.key)?i=a("i18nStrings.awsPrefixError",o==null?void 0:o.awsPrefixError):J(d.key,x)?i=a("i18nStrings.invalidKeyError",o==null?void 0:o.invalidKeyError):Ie(d.key)?i=a("i18nStrings.maxKeyCharLengthError",o==null?void 0:o.maxKeyCharLengthError):Se(d.key,p)&&(i=a("i18nStrings.duplicateKeyError",o==null?void 0:o.duplicateKeyError)),d.markedForRemoval||(J(d.value,x)?e=a("i18nStrings.invalidValueError",o==null?void 0:o.invalidValueError):Ce(d.value)&&(e=a("i18nStrings.maxValueCharLengthError",o==null?void 0:o.maxValueCharLengthError))),i||e)return{key:i,value:e}})}const he=t=>t.toLowerCase().indexOf(xe)===0,Re=t=>!t||t.trim().length===0,Ie=t=>t&&t.length>_e,Se=(t,s)=>{var a;return((a=s==null?void 0:s[t])!==null&&a!==void 0?a:0)>1},Ce=t=>t&&t.length>Le,J=(t,s=ee)=>!t||!s?!1:!s.test(t),Ae=({tag:t})=>!t.markedForRemoval,Te=g.forwardRef((t,s)=>{var a,o,x,p,d,f,{tags:i=[],i18nStrings:e,loading:B=!1,tagLimit:y=50,allowedCharacterPattern:_,keysRequest:N,valuesRequest:I,onChange:K}=t,b=te(t,["tags","i18nStrings","loading","tagLimit","allowedCharacterPattern","keysRequest","valuesRequest","onChange"]);const V=re("TagEditor",{props:{tagLimit:y,allowedCharacterPattern:_}}),l=ie("tag-editor"),k=y-i.filter(n=>!n.markedForRemoval).length,P=c.useRef(null),E=c.useRef([]),S=c.useRef([]),L=c.useRef([]),U=c.useRef([]),h=c.useRef([]),m=c.useRef();c.useLayoutEffect(()=>{var n;(n=m.current)===null||n===void 0||n.apply(void 0),m.current=void 0});const F=Z(i,h.current,l,e,_?new RegExp(_):void 0),T=be(i.map((n,r)=>({tag:n,error:F[r]})),(n,r)=>{var v,u,C,A;return n.tag===r.tag&&((v=n.error)===null||v===void 0?void 0:v.key)===((u=r.error)===null||u===void 0?void 0:u.key)&&((C=n.error)===null||C===void 0?void 0:C.value)===((A=r.error)===null||A===void 0?void 0:A.value)});c.useImperativeHandle(s,()=>({focus(){var n,r;const v=pe(T,({error:u})=>(u==null?void 0:u.key)||(u==null?void 0:u.value));v!==-1&&((r=(!((n=T[v].error)===null||n===void 0)&&n.key?E:S).current[v])===null||r===void 0||r.focus())}}),[T]);const R=c.useCallback(n=>{le(K,{tags:n,valid:!Z(n,h.current,l,e,_?new RegExp(_):void 0).some(r=>r)})},[K,l,e,_]),M=()=>{R([...i,{key:"",value:"",existing:!1}]),m.current=()=>{var n;(n=E.current[i.length])===null||n===void 0||n.focus()}},j=O(({detail:n})=>{var r,v,u,C,A;const z=i[n.itemIndex].existing;R([...i.slice(0,n.itemIndex),...z?[Object.assign(Object.assign({},i[n.itemIndex]),{markedForRemoval:!0})]:[],...i.slice(n.itemIndex+1)]),z?m.current=()=>{var w;(w=L.current[n.itemIndex])===null||w===void 0||w.focus()}:(h.current.splice(n.itemIndex,1),E.current[n.itemIndex+1]?(r=E.current[n.itemIndex])===null||r===void 0||r.focus():n.itemIndex>0?i[n.itemIndex-1].existing?i[n.itemIndex-1].markedForRemoval?(v=L.current[n.itemIndex-1])===null||v===void 0||v.focus():(u=S.current[n.itemIndex-1])===null||u===void 0||u.focus():(C=E.current[n.itemIndex-1])===null||C===void 0||C.focus():(A=P.current)===null||A===void 0||A.focusAddButton())}),H=O((n,r)=>{h.current[r]=!0,R([...i.slice(0,r),Object.assign(Object.assign({},i[r]),{key:n}),...i.slice(r+1)])}),G=O(n=>{h.current[n]=!0,R([...i])}),X=O((n,r)=>{R([...i.slice(0,r),Object.assign(Object.assign({},i[r]),{value:n}),...i.slice(r+1)])}),$=O(n=>{R([...i.slice(0,n),Object.assign(Object.assign({},i[n]),{markedForRemoval:!1}),...i.slice(n+1)]),m.current=()=>{var r;(r=P.current)===null||r===void 0||r.focusRemoveButton(n)}}),ne=c.useMemo(()=>[{label:l("i18nStrings.keyHeader",e==null?void 0:e.keyHeader),control:({tag:n},r)=>g.createElement(Q,{row:r,value:n.key,readOnly:n.existing,limit:200,defaultOptions:[],placeholder:l("i18nStrings.keyPlaceholder",e==null?void 0:e.keyPlaceholder),errorText:l("i18nStrings.keysSuggestionError",e==null?void 0:e.keysSuggestionError),loadingText:l("i18nStrings.keysSuggestionLoading",e==null?void 0:e.keysSuggestionLoading),suggestionText:l("i18nStrings.keySuggestion",e==null?void 0:e.keySuggestion),tooManySuggestionText:l("i18nStrings.tooManyKeysSuggestion",e==null?void 0:e.tooManyKeysSuggestion),enteredTextLabel:e==null?void 0:e.enteredKeyLabel,clearAriaLabel:e==null?void 0:e.clearAriaLabel,onRequest:N,onChange:H,onBlur:G,initialOptionsRef:U,ref:v=>{E.current[r]=v}}),errorText:({error:n})=>n==null?void 0:n.key},{label:g.createElement("span",null,l("i18nStrings.valueHeader",e==null?void 0:e.valueHeader)," -"," ",g.createElement("i",null,l("i18nStrings.optional",e==null?void 0:e.optional))),control:({tag:n},r)=>{var v;return n.markedForRemoval?g.createElement("div",{role:"alert"},g.createElement(ae,{margin:{top:"xxs"}},l("i18nStrings.undoPrompt",e==null?void 0:e.undoPrompt)," ",g.createElement(Ee,{onClick:()=>$(r),ref:u=>{L.current[r]=u}},l("i18nStrings.undoButton",e==null?void 0:e.undoButton)))):g.createElement(Q,{row:r,value:n.value,readOnly:!1,limit:200,defaultOptions:(v=n.valueSuggestionOptions)!==null&&v!==void 0?v:[],placeholder:l("i18nStrings.valuePlaceholder",e==null?void 0:e.valuePlaceholder),errorText:l("i18nStrings.valuesSuggestionError",e==null?void 0:e.valuesSuggestionError),loadingText:l("i18nStrings.valuesSuggestionLoading",e==null?void 0:e.valuesSuggestionLoading),suggestionText:l("i18nStrings.valueSuggestion",e==null?void 0:e.valueSuggestion),tooManySuggestionText:l("i18nStrings.tooManyValuesSuggestion",e==null?void 0:e.tooManyValuesSuggestion),enteredTextLabel:e==null?void 0:e.enteredValueLabel,clearAriaLabel:e==null?void 0:e.clearAriaLabel,filteringKey:n.key,onRequest:I&&(u=>I(n.key,u)),onChange:X,ref:u=>{S.current[r]=u}})},errorText:({error:n})=>n==null?void 0:n.value}],[l,e,N,H,G,I,X,$]),oe=c.useMemo(()=>({errorIconAriaLabel:e==null?void 0:e.errorIconAriaLabel,itemRemovedAriaLive:e==null?void 0:e.itemRemovedAriaLive,removeButtonAriaLabel:l("i18nStrings.removeButtonAriaLabel",(e==null?void 0:e.removeButtonAriaLabel)&&(({tag:n})=>e.removeButtonAriaLabel(n)),n=>({tag:r})=>n({tag__key:r.key}))}),[e,l]);if(B)return g.createElement("div",{className:q.root,ref:V.__internalRootRef},g.createElement(se,{className:q.loading,type:"loading"},g.createElement(ue,{tagName:"span"},l("i18nStrings.loading",e==null?void 0:e.loading))));const Y=de(b);return g.createElement(ge,Object.assign({},Y,V,{ref:P,className:ce(q.root,Y.className),items:T,isItemRemovable:Ae,onAddButtonClick:M,onRemoveButtonClick:j,addButtonText:(a=l("i18nStrings.addButton",e==null?void 0:e.addButton))!==null&&a!==void 0?a:"",removeButtonText:e==null?void 0:e.removeButton,disableAddButton:k<=0,empty:l("i18nStrings.emptyTags",e==null?void 0:e.emptyTags),addButtonVariant:"normal",additionalInfo:k<0?g.createElement(me,{errorIconAriaLabel:e==null?void 0:e.errorIconAriaLabel},(x=l("i18nStrings.tagLimitExceeded",(o=e==null?void 0:e.tagLimitExceeded)===null||o===void 0?void 0:o.call(e,y),n=>n({tagLimit:y})))!==null&&x!==void 0?x:""):k===0?(d=l("i18nStrings.tagLimitReached",(p=e==null?void 0:e.tagLimitReached)===null||p===void 0?void 0:p.call(e,y),n=>n({tagLimit:y})))!==null&&d!==void 0?d:"":l("i18nStrings.tagLimit",(f=e==null?void 0:e.tagLimit)===null||f===void 0?void 0:f.call(e,k,y),n=>n({tagLimitAvailable:`${k===y}`,availableTags:k,tagLimit:y})),definition:ne,i18nStrings:oe}))});ve(Te,"TagEditor");const Ne={tagLimit:t=>`You can add up to ${t} more tag${t>1?"s":""}.`};export{Te as T,Ne as t};
